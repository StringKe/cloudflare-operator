---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.17.2
  name: deviceposturerules.networking.cfargotunnel.com
spec:
  group: networking.cfargotunnel.com
  names:
    kind: DevicePostureRule
    listKind: DevicePostureRuleList
    plural: deviceposturerules
    shortNames:
    - posture
    singular: deviceposturerule
  scope: Cluster
  versions:
  - additionalPrinterColumns:
    - jsonPath: .spec.type
      name: Type
      type: string
    - jsonPath: .status.ruleId
      name: RuleID
      type: string
    - jsonPath: .status.state
      name: State
      type: string
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha2
    schema:
      openAPIV3Schema:
        description: DevicePostureRule is the Schema for the deviceposturerules API.
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: DevicePostureRuleSpec defines the desired state of DevicePostureRule
            properties:
              cloudflare:
                description: Cloudflare contains the Cloudflare API credentials.
                properties:
                  CLOUDFLARE_API_KEY:
                    default: CLOUDFLARE_API_KEY
                    description: |-
                      Key in the secret to use for Cloudflare API Key, defaults to CLOUDFLARE_API_KEY. Needs Email also to be provided.
                      For Delete operations for new tunnels only, or as an alternate to API Token
                    type: string
                  CLOUDFLARE_API_TOKEN:
                    default: CLOUDFLARE_API_TOKEN
                    description: Key in the secret to use for Cloudflare API token,
                      defaults to CLOUDFLARE_API_TOKEN
                    type: string
                  CLOUDFLARE_TUNNEL_CREDENTIAL_FILE:
                    default: CLOUDFLARE_TUNNEL_CREDENTIAL_FILE
                    description: Key in the secret to use as credentials.json for
                      an existing tunnel, defaults to CLOUDFLARE_TUNNEL_CREDENTIAL_FILE
                    type: string
                  CLOUDFLARE_TUNNEL_CREDENTIAL_SECRET:
                    default: CLOUDFLARE_TUNNEL_CREDENTIAL_SECRET
                    description: Key in the secret to use as tunnel secret for an
                      existing tunnel, defaults to CLOUDFLARE_TUNNEL_CREDENTIAL_SECRET
                    type: string
                  accountId:
                    description: Account ID in Cloudflare. AccountId and AccountName
                      cannot be both empty. If both are provided, Account ID is used
                      if valid, else falls back to Account Name.
                    type: string
                  accountName:
                    description: Account Name in Cloudflare. AccountName and AccountId
                      cannot be both empty. If both are provided, Account ID is used
                      if valid, else falls back to Account Name.
                    type: string
                  domain:
                    description: Cloudflare Domain to which this tunnel belongs to
                    type: string
                  email:
                    description: Email to use along with API Key for Delete operations
                      for new tunnels only, or as an alternate to API Token
                    type: string
                  secret:
                    description: Secret containing Cloudflare API key/token
                    type: string
                required:
                - domain
                - secret
                type: object
              description:
                description: Description is a human-readable description.
                maxLength: 1000
                type: string
              expiration:
                description: Expiration is when the rule expires.
                type: string
              input:
                description: Input contains the rule-specific configuration.
                properties:
                  activeThreats:
                    description: ActiveThreats is the maximum active threat count.
                    type: integer
                  certificateId:
                    description: CertificateID for client certificate checks.
                    type: string
                  checkDisks:
                    description: CheckDisks specifies which disks to check encryption.
                    items:
                      type: string
                    type: array
                  commonName:
                    description: CommonName for client certificate checks.
                    type: string
                  complianceStatus:
                    description: ComplianceStatus is the Intune compliance status.
                    enum:
                    - compliant
                    - noncompliant
                    - unknown
                    - notapplicable
                    - ingraceperiod
                    - error
                    type: string
                  connectionId:
                    description: ConnectionID is the third-party integration connection
                      ID.
                    type: string
                  countOperator:
                    description: CountOperator for count comparisons.
                    enum:
                    - <
                    - <=
                    - '>'
                    - '>='
                    - ==
                    type: string
                  domain:
                    description: Domain is the expected domain for domain-joined checks.
                    type: string
                  enabled:
                    description: Enabled checks if feature is enabled.
                    type: boolean
                  exists:
                    description: Exists checks if file exists.
                    type: boolean
                  id:
                    description: ID is a generic identifier for integrations.
                    type: string
                  issueCount:
                    description: IssueCount is the number of issues for SentinelOne.
                    type: integer
                  lastSeen:
                    description: LastSeen is the maximum time since device was last
                      seen.
                    type: string
                  networkStatus:
                    description: NetworkStatus checks for network connection.
                    enum:
                    - connected
                    - disconnected
                    - disconnecting
                    - connecting
                    type: string
                  operator:
                    description: Operator is the version comparison operator.
                    enum:
                    - <
                    - <=
                    - '>'
                    - '>='
                    - ==
                    type: string
                  osDistroName:
                    description: OSDistroName is the OS distribution name.
                    type: string
                  osDistroRevision:
                    description: OSDistroRevision is the OS distribution revision.
                    type: string
                  path:
                    description: Path is the file path to check.
                    type: string
                  requireAll:
                    description: RequireAll requires all conditions to match.
                    type: boolean
                  running:
                    description: Running checks if application is running.
                    type: boolean
                  sensorConfig:
                    description: SensorConfig checks sensor configuration.
                    enum:
                    - active
                    - disabled
                    - not_configured
                    type: string
                  sha256:
                    description: Sha256 is the expected file hash.
                    type: string
                  thumbprint:
                    description: Thumbprint is the certificate thumbprint.
                    type: string
                  version:
                    description: Version is the minimum version.
                    type: string
                  versionOperator:
                    description: VersionOperator for CrowdStrike version checks.
                    enum:
                    - <
                    - <=
                    - '>'
                    - '>='
                    - ==
                    type: string
                type: object
              match:
                description: Match defines which devices this rule applies to.
                items:
                  description: DevicePostureMatch defines platform matching.
                  properties:
                    platform:
                      description: Platform is the OS platform.
                      enum:
                      - windows
                      - mac
                      - linux
                      - android
                      - ios
                      - chromeos
                      type: string
                  type: object
                type: array
              name:
                description: Name of the Device Posture Rule in Cloudflare.
                maxLength: 255
                type: string
              schedule:
                description: Schedule determines how often the rule is evaluated.
                type: string
              type:
                description: Type is the posture rule type.
                enum:
                - file
                - application
                - serial_number
                - tanium
                - gateway
                - warp
                - disk_encryption
                - sentinelone
                - carbonblack
                - firewall
                - os_version
                - domain_joined
                - client_certificate
                - unique_client_id
                - kolide
                - tanium_s2s
                - crowdstrike_s2s
                - intune
                - workspace_one
                type: string
            required:
            - cloudflare
            - type
            type: object
          status:
            description: DevicePostureRuleStatus defines the observed state
            properties:
              accountId:
                description: AccountID is the Cloudflare Account ID.
                type: string
              conditions:
                description: Conditions represent the latest available observations.
                items:
                  description: Condition contains details for one aspect of the current
                    state of this API Resource.
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
                x-kubernetes-list-map-keys:
                - type
                x-kubernetes-list-type: map
              observedGeneration:
                description: ObservedGeneration is the most recent generation observed.
                format: int64
                type: integer
              ruleId:
                description: RuleID is the Cloudflare Device Posture Rule ID.
                type: string
              state:
                description: State indicates the current state.
                type: string
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
