---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.17.2
  name: accessidentityproviders.networking.cloudflare-operator.io
spec:
  group: networking.cloudflare-operator.io
  names:
    kind: AccessIdentityProvider
    listKind: AccessIdentityProviderList
    plural: accessidentityproviders
    shortNames:
    - accessidp
    singular: accessidentityprovider
  scope: Cluster
  versions:
  - additionalPrinterColumns:
    - jsonPath: .spec.type
      name: Type
      type: string
    - jsonPath: .status.providerId
      name: ProviderID
      type: string
    - jsonPath: .status.state
      name: State
      type: string
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha2
    schema:
      openAPIV3Schema:
        description: AccessIdentityProvider is the Schema for the accessidentityproviders
          API.
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: AccessIdentityProviderSpec defines the desired state of AccessIdentityProvider
            properties:
              cloudflare:
                description: Cloudflare contains the Cloudflare API credentials.
                properties:
                  CLOUDFLARE_API_KEY:
                    description: |-
                      Key in the secret to use for Cloudflare API Key.
                      If not specified, defaults to "CLOUDFLARE_API_KEY" at runtime.
                      Needs Email also to be provided.
                      For Delete operations for new tunnels only, or as an alternate to API Token.
                    type: string
                  CLOUDFLARE_API_TOKEN:
                    description: |-
                      Key in the secret to use for Cloudflare API token.
                      If not specified, defaults to "CLOUDFLARE_API_TOKEN" at runtime.
                    type: string
                  CLOUDFLARE_TUNNEL_CREDENTIAL_FILE:
                    description: |-
                      Key in the secret to use as credentials.json for an existing tunnel.
                      If not specified, defaults to "CLOUDFLARE_TUNNEL_CREDENTIAL_FILE" at runtime.
                    type: string
                  CLOUDFLARE_TUNNEL_CREDENTIAL_SECRET:
                    description: |-
                      Key in the secret to use as tunnel secret for an existing tunnel.
                      If not specified, defaults to "CLOUDFLARE_TUNNEL_CREDENTIAL_SECRET" at runtime.
                    type: string
                  accountId:
                    description: Account ID in Cloudflare. AccountId and AccountName
                      cannot be both empty. If both are provided, Account ID is used
                      if valid, else falls back to Account Name.
                    type: string
                  accountName:
                    description: Account Name in Cloudflare. AccountName and AccountId
                      cannot be both empty. If both are provided, Account ID is used
                      if valid, else falls back to Account Name.
                    type: string
                  credentialsRef:
                    description: |-
                      CredentialsRef references a CloudflareCredentials resource for API authentication.
                      When specified, this takes precedence over inline credential fields.
                      This is the recommended way to configure credentials.
                    properties:
                      name:
                        description: Name of the CloudflareCredentials resource to
                          use
                        type: string
                    required:
                    - name
                    type: object
                  domain:
                    description: |-
                      Cloudflare Domain to which this tunnel belongs to.
                      Required if not using credentialsRef with a defaultDomain.
                    type: string
                  email:
                    description: Email to use along with API Key for Delete operations
                      for new tunnels only, or as an alternate to API Token
                    type: string
                  secret:
                    description: Secret containing Cloudflare API key/token (legacy,
                      use credentialsRef instead)
                    type: string
                  zoneId:
                    description: |-
                      ZoneId is the Cloudflare Zone ID for DNS operations.
                      If not specified, it will be looked up via CloudflareDomain or the domain field.
                      Specifying this directly is useful for multi-zone scenarios.
                    type: string
                type: object
              config:
                description: Config contains provider-specific configuration.
                properties:
                  apiToken:
                    description: APIToken is the API token (GitHub, etc).
                    type: string
                  appsDomain:
                    description: AppsDomain is the Google Workspace domain.
                    type: string
                  attributes:
                    description: Attributes are custom attributes to include in tokens.
                    items:
                      type: string
                    type: array
                  authUrl:
                    description: AuthURL is the authorization URL (OIDC/OAuth).
                    type: string
                  centrifyAccount:
                    description: CentrifyAccount is the Centrify account.
                    type: string
                  centrifyAppId:
                    description: CentrifyAppID is the Centrify app ID.
                    type: string
                  certsUrl:
                    description: CertsURL is the JWKS endpoint URL.
                    type: string
                  claims:
                    description: Claims are custom OIDC claims to include.
                    items:
                      type: string
                    type: array
                  clientId:
                    description: ClientID is the OAuth client ID.
                    type: string
                  clientSecret:
                    description: ClientSecret is the OAuth client secret (use ConfigSecretRef
                      for sensitive values).
                    type: string
                  conditionalAccessEnabled:
                    description: ConditionalAccessEnabled enables Azure AD conditional
                      access.
                    type: boolean
                  directoryId:
                    description: DirectoryID is the Azure AD directory ID.
                    type: string
                  emailAttributeName:
                    description: EmailAttributeName is the SAML attribute containing
                      email.
                    type: string
                  emailClaimName:
                    description: EmailClaimName is the claim containing the user's
                      email.
                    type: string
                  headerAttributes:
                    description: HeaderAttributes are SAML attributes to pass as headers.
                    items:
                      description: SAMLHeaderAttribute defines a SAML attribute to
                        header mapping.
                      properties:
                        attributeName:
                          description: AttributeName is the SAML attribute name.
                          type: string
                        headerName:
                          description: HeaderName is the HTTP header name.
                          type: string
                        required:
                          description: Required indicates if this attribute is required.
                          type: boolean
                      required:
                      - attributeName
                      - headerName
                      type: object
                    type: array
                  idpPublicCert:
                    description: IdPPublicCert is the IdP's public certificate for
                      SAML (single cert).
                    type: string
                  issuerUrl:
                    description: IssuerURL is the OIDC issuer URL.
                    type: string
                  oktaAccount:
                    description: OktaAccount is the Okta organization URL.
                    type: string
                  oktaAuthorizationServerId:
                    description: OktaAuthorizationServerID is the Okta authorization
                      server ID.
                    type: string
                  oneloginAccount:
                    description: OneloginAccount is the OneLogin subdomain.
                    type: string
                  pingEnvId:
                    description: PingEnvID is the PingOne environment ID.
                    type: string
                  pkceEnabled:
                    description: PKCEEnabled enables PKCE.
                    type: boolean
                  redirectUrl:
                    description: RedirectURL is the callback URL.
                    type: string
                  scopes:
                    description: Scopes are the OAuth scopes to request.
                    items:
                      type: string
                    type: array
                  signRequest:
                    description: SignRequest enables SAML request signing.
                    type: boolean
                  ssoTargetUrl:
                    description: SSOTargetURL is the SAML SSO URL.
                    type: string
                  supportGroups:
                    description: SupportGroups enables group sync.
                    type: boolean
                  tokenUrl:
                    description: TokenURL is the token endpoint URL.
                    type: string
                type: object
              configSecretRef:
                description: ConfigSecretRef references a Secret containing sensitive
                  config values.
                properties:
                  key:
                    description: Key is the key in the Secret.
                    type: string
                  name:
                    description: Name is the name of the Secret.
                    type: string
                  namespace:
                    description: Namespace is the namespace of the Secret.
                    type: string
                required:
                - key
                - name
                type: object
              name:
                description: Name of the Identity Provider in Cloudflare.
                maxLength: 255
                type: string
              scimConfig:
                description: ScimConfig contains SCIM provisioning configuration.
                properties:
                  enabled:
                    description: Enabled enables SCIM provisioning.
                    type: boolean
                  groupMemberDeprovision:
                    description: GroupMemberDeprovision enables automatic group member
                      deprovisioning.
                    type: boolean
                  identityUpdateBehavior:
                    description: IdentityUpdateBehavior controls how identity updates
                      are handled.
                    enum:
                    - automatic
                    - reauth
                    - no_action
                    type: string
                  seatDeprovision:
                    description: SeatDeprovision enables automatic seat deprovisioning.
                    type: boolean
                  secret:
                    description: Secret is the SCIM secret (should use a Secret reference
                      in production).
                    type: string
                  userDeprovision:
                    description: UserDeprovision enables automatic user deprovisioning.
                    type: boolean
                type: object
              type:
                description: Type is the identity provider type.
                enum:
                - onetimepin
                - azureAD
                - saml
                - centrify
                - facebook
                - github
                - google-apps
                - google
                - linkedin
                - oidc
                - okta
                - onelogin
                - pingone
                - yandex
                type: string
            required:
            - cloudflare
            - type
            type: object
          status:
            description: AccessIdentityProviderStatus defines the observed state
            properties:
              accountId:
                description: AccountID is the Cloudflare Account ID.
                type: string
              conditions:
                description: Conditions represent the latest available observations.
                items:
                  description: Condition contains details for one aspect of the current
                    state of this API Resource.
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
                x-kubernetes-list-map-keys:
                - type
                x-kubernetes-list-type: map
              observedGeneration:
                description: ObservedGeneration is the most recent generation observed.
                format: int64
                type: integer
              providerId:
                description: ProviderID is the Cloudflare ID.
                type: string
              state:
                description: State indicates the current state.
                type: string
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
