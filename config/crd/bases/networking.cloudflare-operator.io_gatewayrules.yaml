---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.17.2
  name: gatewayrules.networking.cloudflare-operator.io
spec:
  group: networking.cloudflare-operator.io
  names:
    kind: GatewayRule
    listKind: GatewayRuleList
    plural: gatewayrules
    shortNames:
    - gwrule
    singular: gatewayrule
  scope: Cluster
  versions:
  - additionalPrinterColumns:
    - jsonPath: .spec.action
      name: Action
      type: string
    - jsonPath: .spec.precedence
      name: Precedence
      type: integer
    - jsonPath: .spec.enabled
      name: Enabled
      type: boolean
    - jsonPath: .status.ruleId
      name: RuleID
      type: string
    - jsonPath: .status.state
      name: State
      type: string
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha2
    schema:
      openAPIV3Schema:
        description: GatewayRule is the Schema for the gatewayrules API.
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: GatewayRuleSpec defines the desired state of GatewayRule
            properties:
              action:
                description: Action is what happens when the rule matches.
                enum:
                - allow
                - block
                - log
                - isolate
                - l4_override
                - egress
                - resolve
                - quarantine
                type: string
              cloudflare:
                description: Cloudflare contains the Cloudflare API credentials.
                properties:
                  CLOUDFLARE_API_KEY:
                    default: CLOUDFLARE_API_KEY
                    description: |-
                      Key in the secret to use for Cloudflare API Key, defaults to CLOUDFLARE_API_KEY. Needs Email also to be provided.
                      For Delete operations for new tunnels only, or as an alternate to API Token
                    type: string
                  CLOUDFLARE_API_TOKEN:
                    default: CLOUDFLARE_API_TOKEN
                    description: Key in the secret to use for Cloudflare API token,
                      defaults to CLOUDFLARE_API_TOKEN
                    type: string
                  CLOUDFLARE_TUNNEL_CREDENTIAL_FILE:
                    default: CLOUDFLARE_TUNNEL_CREDENTIAL_FILE
                    description: Key in the secret to use as credentials.json for
                      an existing tunnel, defaults to CLOUDFLARE_TUNNEL_CREDENTIAL_FILE
                    type: string
                  CLOUDFLARE_TUNNEL_CREDENTIAL_SECRET:
                    default: CLOUDFLARE_TUNNEL_CREDENTIAL_SECRET
                    description: Key in the secret to use as tunnel secret for an
                      existing tunnel, defaults to CLOUDFLARE_TUNNEL_CREDENTIAL_SECRET
                    type: string
                  accountId:
                    description: Account ID in Cloudflare. AccountId and AccountName
                      cannot be both empty. If both are provided, Account ID is used
                      if valid, else falls back to Account Name.
                    type: string
                  accountName:
                    description: Account Name in Cloudflare. AccountName and AccountId
                      cannot be both empty. If both are provided, Account ID is used
                      if valid, else falls back to Account Name.
                    type: string
                  domain:
                    description: Cloudflare Domain to which this tunnel belongs to
                    type: string
                  email:
                    description: Email to use along with API Key for Delete operations
                      for new tunnels only, or as an alternate to API Token
                    type: string
                  secret:
                    description: Secret containing Cloudflare API key/token
                    type: string
                required:
                - domain
                - secret
                type: object
              description:
                description: Description is a human-readable description.
                maxLength: 1000
                type: string
              devicePosture:
                description: DevicePosture is the wirefilter expression for device
                  posture matching.
                type: string
              enabled:
                default: true
                description: Enabled controls whether the rule is active.
                type: boolean
              filters:
                description: Filters specifies which types of traffic this rule applies
                  to.
                items:
                  type: string
                type: array
              identity:
                description: Identity is the wirefilter expression for identity matching.
                type: string
              name:
                description: Name of the Gateway Rule in Cloudflare.
                maxLength: 255
                type: string
              precedence:
                description: Precedence determines the order of rule evaluation (lower
                  = earlier).
                minimum: 0
                type: integer
              ruleSettings:
                description: RuleSettings contains action-specific settings.
                properties:
                  addHeaders:
                    additionalProperties:
                      type: string
                    description: AddHeaders adds headers to requests.
                    type: object
                  auditSsh:
                    description: AuditSSH enables SSH command logging.
                    properties:
                      commandLogging:
                        type: boolean
                    required:
                    - commandLogging
                    type: object
                  bisoAdminControls:
                    description: BISOAdminControls for browser isolation.
                    properties:
                      disableClipboardRedirection:
                        type: boolean
                      disableCopyPaste:
                        type: boolean
                      disableDownload:
                        type: boolean
                      disableKeyboard:
                        type: boolean
                      disablePrinting:
                        type: boolean
                      disableUpload:
                        type: boolean
                    type: object
                  blockPageEnabled:
                    description: BlockPageEnabled enables custom block page.
                    type: boolean
                  blockReason:
                    description: BlockReason is shown on the block page.
                    type: string
                  checkSession:
                    description: CheckSession enables session check.
                    properties:
                      duration:
                        type: string
                      enforce:
                        type: boolean
                    required:
                    - duration
                    - enforce
                    type: object
                  dnsResolverIpv4:
                    description: DNSResolverIPv4 custom resolver.
                    properties:
                      ip:
                        type: string
                      port:
                        type: integer
                      routeThroughPrivateNetwork:
                        type: boolean
                      vnetId:
                        type: string
                    type: object
                  dnsResolverIpv6:
                    description: DNSResolverIPv6 custom resolver.
                    properties:
                      ip:
                        type: string
                      port:
                        type: integer
                      routeThroughPrivateNetwork:
                        type: boolean
                      vnetId:
                        type: string
                    type: object
                  egress:
                    description: EgressSettings for egress action.
                    properties:
                      ipv4:
                        type: string
                      ipv4Fallback:
                        type: string
                      ipv6:
                        type: string
                    type: object
                  insecureDisableDnssecValidation:
                    description: InsecureDisableDNSSECValidation disables DNSSEC validation.
                    type: boolean
                  l4Override:
                    description: L4Override for L4 override action.
                    properties:
                      ip:
                        type: string
                      port:
                        type: integer
                    required:
                    - ip
                    - port
                    type: object
                  notificationSettings:
                    description: NotificationSettings for alerts.
                    properties:
                      enabled:
                        type: boolean
                      message:
                        type: string
                      supportUrl:
                        type: string
                    required:
                    - enabled
                    type: object
                  overrideHost:
                    description: OverrideHost for DNS override action.
                    type: string
                  overrideIps:
                    description: OverrideIPs for DNS override action.
                    items:
                      type: string
                    type: array
                  payloadLog:
                    description: PayloadLog configures logging.
                    properties:
                      enabled:
                        type: boolean
                    required:
                    - enabled
                    type: object
                  resolveDnsInternally:
                    description: ResolveDNSInternally for private DNS resolution.
                    type: boolean
                  untrustedCertificateAction:
                    description: UntrustedCertificateAction for TLS inspection.
                    enum:
                    - pass_through
                    - block
                    - error
                    type: string
                type: object
              traffic:
                description: Traffic is the wirefilter expression for traffic matching.
                type: string
            required:
            - action
            - cloudflare
            - precedence
            type: object
          status:
            description: GatewayRuleStatus defines the observed state
            properties:
              accountId:
                description: AccountID is the Cloudflare Account ID.
                type: string
              conditions:
                description: Conditions represent the latest available observations.
                items:
                  description: Condition contains details for one aspect of the current
                    state of this API Resource.
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
                x-kubernetes-list-map-keys:
                - type
                x-kubernetes-list-type: map
              observedGeneration:
                description: ObservedGeneration is the most recent generation observed.
                format: int64
                type: integer
              ruleId:
                description: RuleID is the Cloudflare Gateway Rule ID.
                type: string
              state:
                description: State indicates the current state.
                type: string
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
