# HTTPRoute defines routing rules for HTTP/HTTPS traffic.
# This example routes traffic from api.example.com to backend services.
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: api-route
  namespace: default
  annotations:
    # Optional: Override DNS proxied setting
    # cloudflare-operator.io/dns-proxied: "true"
    # Optional: Disable DNS record management for this route
    # cloudflare-operator.io/disable-dns: "true"
spec:
  # Attach to the production Gateway
  parentRefs:
    - name: production
      namespace: default
      sectionName: https
  # Hostnames this route will match
  hostnames:
    - "api.example.com"
  # Routing rules
  rules:
    # Route /v1/* to api-v1 service
    - matches:
        - path:
            type: PathPrefix
            value: /v1
      backendRefs:
        - name: api-v1
          port: 8080
    # Route /v2/* to api-v2 service
    - matches:
        - path:
            type: PathPrefix
            value: /v2
      backendRefs:
        - name: api-v2
          port: 8080
    # Default route to latest API version
    - matches:
        - path:
            type: PathPrefix
            value: /
      backendRefs:
        - name: api-v2
          port: 8080
---
# Multiple hostnames example
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: web-app-route
  namespace: default
spec:
  parentRefs:
    - name: production
      sectionName: http
  hostnames:
    - "app.example.com"
    - "www.example.com"
  rules:
    # Route all traffic to web frontend
    - matches:
        - path:
            type: PathPrefix
            value: /
      backendRefs:
        - name: web-frontend
          port: 80
---
# Header-based routing example
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: header-based-route
  namespace: default
spec:
  parentRefs:
    - name: production
      sectionName: https
  hostnames:
    - "api.example.com"
  rules:
    # Route beta traffic to canary deployment
    - matches:
        - headers:
            - name: X-Beta-User
              value: "true"
          path:
            type: PathPrefix
            value: /
      backendRefs:
        - name: api-canary
          port: 8080
